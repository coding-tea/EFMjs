<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TP Ajax</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        img {
            width: 50px;
        }
    </style>
</head>
<body>

<div id="index" class="container mt-5">
    <div class="date-header row">
        <button class="btn btn-primary col-12 col-sm-2" id="addetd">Add Etudiant</button>
        <div class="col-12 col-sm-7"></div>
        <div class="col-12 col-sm-3">
            <input type="search" id="search" class="form-control" placeholder="search.." />
        </div>
    </div>
    <div class="data-body mt-2">
        <table class="table">
            <thead>
            <tr>
                <th>Id</th>
                <th>Civilite</th>
                <th>Nom</th>
                <th>Prenom</th>
                <th>Email</th>
                <th>Photo</th>
                <th>Actions</th>
            </tr>
            </thead>
            <tbody id="data"></tbody>
        </table>
    </div>
</div>

<div id="add" class="container mt-5" style="display: none;">
    <h1>Ajouter un Etudiant</h1>
    <form action="" method="post" onsubmit="return false" class="row">
        <div class="col-12 mt-5">
            <label for="civilite" class="form-label">Civilite</label>
            <input type="text" class="form-control" id="civilite" />
        </div>
        <div class="col-12 col-sm-6 mt-5">
            <label for="nom" class="form-label">Nom</label>
            <input type="text" class="form-control" id="nom" />
        </div>
        <div class="col-12 col-sm-6 mt-5">
            <label for="prenom" class="form-label">Prenom</label>
            <input type="text" class="form-control" id="prenom" />
        </div>
        <div class="col-12 col-sm-6 mt-5">
            <label for="email" class="form-label">Email</label>
            <input type="text" class="form-control" id="email" />
        </div>
        <div class="col-12 col-sm-6 mt-5">
            <label for="photo" class="form-label">Photo</label>
            <input type="file" class="form-control" id="photo" />
        </div>
        <div class="col-12 mt-5">
            <button type="submit" class="btn btn-success">Ajouter</button>
            <button type="button" class="btn btn-warning" id="backadd">Retour</button>
        </div>
    </form>
</div>

<div id="edit" class="container mt-5" style="display: none;">
    <h1>Edit un Etudiant</h1>
    <form action="" method="post" onsubmit="return false" class="row">
        <div class="col-12 mt-5">
            <label for="civilite" class="form-label">Civilite</label>
            <input type="text" class="form-control" id="civilite" />
        </div>
        <div class="col-12 col-sm-6 mt-5">
            <label for="nom" class="form-label">Nom</label>
            <input type="text" class="form-control" id="nom" />
        </div>
        <div class="col-12 col-sm-6 mt-5">
            <label for="prenom" class="form-label">Prenom</label>
            <input type="text" class="form-control" id="prenom" />
        </div>
        <div class="col-12 col-sm-6 mt-5">
            <label for="email" class="form-label">Email</label>
            <input type="text" class="form-control" id="email" />
        </div>
        <div class="col-12 col-sm-6 mt-5">
            <label for="photo" class="form-label">Photo</label>
            <input type="file" class="form-control" id="photo" />
        </div>
        <div class="col-12 mt-5">
            <button type="submit" id="update" class="btn btn-success">update</button>
            <button type="button" class="btn btn-warning" id="backedit">Retour</button>
        </div>
    </form>
</div>

<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
    function destroyetd(id) {
        swal({
            title: "Are you sure?",
            text: "Once deleted, you will not be able to recover this imaginary file!",
            icon: "warning",
            buttons: true,
            dangerMode: true,
        }).then((willDelete) => {
            if (willDelete) {
                $.ajax({
                    type: 'GET',
                    url: 'http://localhost/EFMJS/Router.php?action=delete&id=' + id,
                    success: function (response) {
                        swal("Poof! Etudiant has been deleted!", {
                            icon: "success",
                        });
                        var table = document.querySelector('#data');
                        var tbody = "";
                        $.ajax({
                            type: "GET",
                            url: 'http://localhost/EFMJS/Router.php?action=getAll',
                            success: function (response) {
                                response = JSON.parse(response);
                                response.forEach(element => {
                                    let pic = (element.photo != "null") ? "./img/" + element.photo : "./img/default.jpeg";
                                    tbody += `
                                    <tr>
                                        <td>${element.id}</td>
                                        <td>${element.civilite}</td>
                                        <td>${element.nom}</td>
                                        <td>${element.prenom}</td>
                                        <td>${element.email}</td>
                                        <td><img src="${pic}" /></td>
                                        <td class='text-end'>
                                            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modaletd${element.id}">
                                                View
                                            </button>
                                            <button class='btn btn-success' onclick="editetd(${element.id})">Edit</button>
                                            <button class='btn btn-danger' onclick="destroyetd(${element.id})">Delete</button>
                                        </td>
                                    </tr>
                                    <div class="modal fade" id="modaletd${element.id}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                                        <div class="modal-dialog">
                                            <div class="modal-content">
                                                <div class="modal-header">
                                                    <h1 class="modal-title fs-5" id="exampleModalLabel">Etudiant ${element.id}</h1>
                                                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                </div>
                                                <div class="modal-body">
                                                    <b>civilite: ${element.civilite}</b><br>
                                                    <b>nom: ${element.nom}</b><br>
                                                    <b>prenom: ${element.prenom}</b><br>
                                                    <b>email: ${element.email}</b><br>
                                                    <b>photo:</b><br>
                                                    <img src="${pic}" />
                                                </div>
                                                <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    `;
                                });
                                table.innerHTML = tbody;
                            }
                        });
                    }
                });
            }
        });
    }

    function editetd(id) {
        $.ajax({
            type: "GET",
            url: 'http://localhost/EFMJS/Router.php?action=get&id=' + id,
            success: function (response) {
                response = JSON.parse(response);
                console.log(response)
                $("#edit #civilite").val(response[0].civilite);
                $("#edit #nom").val(response[0].nom);
                $("#edit #prenom").val(response[0].prenom);
                $("#edit #email").val(response[0].email);
                $("#edit #photo").val(response[0].photo);

                $("#index").hide();
                $("#edit").show();
            }
        });
    }

    $(document).ready(function () {
        $("#add").hide();
        $("#edit").hide();

        function getAll() {
            var table = document.querySelector('#data');
            var tbody = "";
            $.ajax({
                type: "GET",
                url: 'http://localhost/EFMJS/Router.php?action=getAll',
                success: function (response) {
                    response = JSON.parse(response);
                    response.forEach(element => {
                        let pic = (element.photo != "null") ? "./img/" + element.photo : "./img/default.jpeg";
                        tbody += `
                        <tr>
                            <td>${element.id}</td>
                            <td>${element.civilite}</td>
                            <td>${element.nom}</td>
                            <td>${element.prenom}</td>
                            <td>${element.email}</td>
                            <td><img src="${pic}" /></td>
                            <td class='text-end'>
                                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modaletd${element.id}">
                                    View
                                </button>
                                <button class='btn btn-success' onclick="editetd(${element.id})">Edit</button>
                                <button class='btn btn-danger' onclick="destroyetd(${element.id})">Delete</button>
                            </td>
                        </tr>
                        <div class="modal fade" id="modaletd${element.id}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h1 class="modal-title fs-5" id="exampleModalLabel">Etudiant ${element.id}</h1>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <b>civilite: ${element.civilite}</b><br>
                                        <b>nom: ${element.nom}</b><br>
                                        <b>prenom: ${element.prenom}</b><br>
                                        <b>email: ${element.email}</b><br>
                                        <b>photo:</b><br>
                                        <img src="${pic}" />
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        `;
                    });
                    table.innerHTML = tbody;
                }
            });
        }

        $('#backedit').click(() => {
            $("#add").hide();
            $("#edit").hide();
            $("#index").show();
        });

        $('#backadd').click(() => {
            $("#add").hide();
            $("#edit").hide();
            $("#index").show();
        });

        $('#addetd').click(() => {
            $("#add").show();
            $("#index").hide();
        });

        getAll();

        $("#update").click(function(){
            let civilite = $("#edit #civilite").val();
            let nom = $("#edit #nom").val();
            let prenom = $("#edit #prenom").val();
            let email = $("#edit #email").val();
            let photo = $("#edit #photo").val();
            $.ajax({
                type: "POST",
                url: "http://localhost/EFMJS/Router.php?action=update",
                data: {
                    civilite,
                    nom,
                    prenom,
                    email,
                    photo,
                },
                success:function(){
                    console.log("hello world");
                },
            });
        })
    });
</script>
</body>
</html>
